<!DOCTYPE html>
<html>
<head>
  <title>Populate Test Data - Reports</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
      color: #6366f1;
      margin-bottom: 20px;
    }
    button {
      background: #6366f1;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
      margin: 10px 10px 10px 0;
    }
    button:hover {
      background: #4f46e5;
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    .log {
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      border-radius: 6px;
      padding: 15px;
      margin-top: 20px;
      max-height: 400px;
      overflow-y: auto;
      font-family: monospace;
      font-size: 13px;
    }
    .log-entry {
      padding: 5px 0;
      border-bottom: 1px solid #e5e7eb;
    }
    .log-entry:last-child {
      border-bottom: none;
    }
    .success { color: #10b981; }
    .error { color: #ef4444; }
    .info { color: #3b82f6; }
    .warning { color: #f59e0b; }
  </style>
</head>
<body>
  <div class="container">
    <h1>üìä Populate Test Data for Reports</h1>
    <p>This will create sample appointments and resource bookings to test the Reports page.</p>
    
    <div>
      <button id="populateBtn" onclick="populateData()">üöÄ Populate Test Data</button>
      <button onclick="clearLog()">Clear Log</button>
      <button onclick="viewReports()">View Reports Page</button>
    </div>
    
    <div class="log" id="log"></div>
  </div>

  <script>
    const API_BASE = 'http://localhost:5001';
    
    const teamMembers = [
      { id: '1', name: 'Dr. Sarah Johnson' },
      { id: '2', name: 'Dr. Michael Chen' },
      { id: '3', name: 'Dr. Emily Rodriguez' },
      { id: '4', name: 'Dr. James Wilson' },
    ];

    const services = [
      { name: 'Initial Consultation', duration: '60 mins', price: 150 },
      { name: 'Follow-up Visit', duration: '30 mins', price: 75 },
      { name: 'Therapy Session', duration: '45 mins', price: 120 },
      { name: 'Annual Check-up', duration: '90 mins', price: 200 },
      { name: 'Specialist Consultation', duration: '60 mins', price: 180 },
    ];

    const customers = [
      { name: 'John Smith', email: 'john.smith@email.com', phone: '555-0101' },
      { name: 'Emma Davis', email: 'emma.davis@email.com', phone: '555-0102' },
      { name: 'Michael Brown', email: 'michael.brown@email.com', phone: '555-0103' },
      { name: 'Sarah Wilson', email: 'sarah.wilson@email.com', phone: '555-0104' },
      { name: 'David Martinez', email: 'david.martinez@email.com', phone: '555-0105' },
      { name: 'Lisa Anderson', email: 'lisa.anderson@email.com', phone: '555-0106' },
      { name: 'Robert Taylor', email: 'robert.taylor@email.com', phone: '555-0107' },
      { name: 'Jennifer White', email: 'jennifer.white@email.com', phone: '555-0108' },
      { name: 'William Harris', email: 'william.harris@email.com', phone: '555-0109' },
      { name: 'Amanda Clark', email: 'amanda.clark@email.com', phone: '555-0110' },
    ];

    function log(message, type = 'info') {
      const logDiv = document.getElementById('log');
      const entry = document.createElement('div');
      entry.className = `log-entry ${type}`;
      entry.textContent = `${new Date().toLocaleTimeString()} - ${message}`;
      logDiv.appendChild(entry);
      logDiv.scrollTop = logDiv.scrollHeight;
    }

    function clearLog() {
      document.getElementById('log').innerHTML = '';
    }

    function getRandomElement(array) {
      return array[Math.floor(Math.random() * array.length)];
    }

    function getRandomDate(daysBack) {
      const date = new Date();
      date.setDate(date.getDate() - Math.floor(Math.random() * daysBack));
      return date.toISOString().split('T')[0];
    }

    function getRandomTime() {
      const hours = 9 + Math.floor(Math.random() * 9);
      const minutes = Math.random() < 0.5 ? '00' : '30';
      const ampm = hours >= 12 ? 'PM' : 'AM';
      const displayHour = hours > 12 ? hours - 12 : hours;
      return `${displayHour}:${minutes} ${ampm}`;
    }

    function getWeightedStatus() {
      const rand = Math.random();
      if (rand < 0.7) return 'completed';
      if (rand < 0.9) return 'upcoming';
      return 'cancelled';
    }

    async function createAppointments(count = 50, workspaceId = null) {
      log(`Creating ${count} appointments...`, 'info');
      let success = 0;
      let failed = 0;

      for (let i = 0; i < count; i++) {
        const customer = getRandomElement(customers);
        const service = getRandomElement(services);
        const teamMember = getRandomElement(teamMembers);
        const status = getWeightedStatus();

        const appointment = {
          customerName: customer.name,
          email: customer.email,
          phone: customer.phone,
          serviceName: service.name,
          serviceId: `service-${services.indexOf(service)}`,
          assignedMemberId: teamMember.id,
          assignedMemberName: teamMember.name,
          workspaceId: workspaceId,
          date: getRandomDate(90),
          time: getRandomTime(),
          status: status,
          notes: `Test appointment ${i + 1}`,
        };

        try {
          const response = await fetch(`${API_BASE}/api/appointments`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(appointment),
          });

          if (response.ok) {
            success++;
          } else {
            failed++;
          }
        } catch (error) {
          failed++;
        }
      }

      log(`‚úÖ Appointments: ${success} created, ${failed} failed`, success > 0 ? 'success' : 'error');
      return success;
    }

    async function createResources() {
      log('Creating resources...', 'info');

      const resources = [
        {
          name: 'Conference Room A',
          type: 'Room',
          description: 'Large conference room with video conferencing',
          status: 'available',
          capacity: '12',
        },
        {
          name: 'Conference Room B',
          type: 'Room',
          description: 'Small meeting room',
          status: 'available',
          capacity: '6',
        },
        {
          name: 'Projector - Sony 4K',
          type: 'Equipment',
          description: '4K projector for presentations',
          status: 'available',
        },
        {
          name: 'Zoom Account Pro',
          type: 'Zoom Account',
          description: 'Professional Zoom account',
          status: 'available',
        },
        {
          name: 'Company Van',
          type: 'Vehicle',
          description: '8-seater company vehicle',
          status: 'available',
          capacity: '8',
        },
      ];

      const createdResources = [];

      for (const resource of resources) {
        try {
          const response = await fetch(`${API_BASE}/api/resources`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(resource),
          });

          if (response.ok) {
            const data = await response.json();
            createdResources.push(data);
            log(`‚úÖ Created resource: ${resource.name}`, 'success');
          }
        } catch (error) {
          log(`‚ùå Failed to create: ${resource.name}`, 'error');
        }
      }

      return createdResources;
    }

    async function createResourceBookings(resources, count = 30) {
      if (resources.length === 0) {
        log('‚ö†Ô∏è No resources available, skipping resource bookings', 'warning');
        return 0;
      }

      log(`Creating ${count} resource bookings...`, 'info');
      let success = 0;
      let failed = 0;

      for (let i = 0; i < count; i++) {
        const resource = getRandomElement(resources);
        const customer = getRandomElement(customers);
        const date = new Date();
        date.setDate(date.getDate() - Math.floor(Math.random() * 60));

        const startHour = 9 + Math.floor(Math.random() * 8);
        const duration = 1 + Math.floor(Math.random() * 3);

        const startTime = new Date(date);
        startTime.setHours(startHour, 0, 0, 0);

        const endTime = new Date(startTime);
        endTime.setHours(startTime.getHours() + duration);

        const booking = {
          resourceId: resource.id,
          bookedBy: customer.name,
          startTime: startTime.toISOString(),
          endTime: endTime.toISOString(),
          status: Math.random() > 0.1 ? 'confirmed' : 'cancelled',
          notes: `Resource booking ${i + 1}`,
        };

        try {
          const response = await fetch(`${API_BASE}/api/resource-bookings`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(booking),
          });

          if (response.ok) {
            success++;
          } else {
            failed++;
          }
        } catch (error) {
          failed++;
        }
      }

      log(`‚úÖ Resource bookings: ${success} created, ${failed} failed`, success > 0 ? 'success' : 'error');
      return success;
    }

    async function populateData() {
      const btn = document.getElementById('populateBtn');
      btn.disabled = true;
      btn.textContent = 'Populating...';

      clearLog();
      log('üöÄ Starting test data population...', 'info');

      try {
        // Test API connectivity
        const testResponse = await fetch(`${API_BASE}/api/appointments`);
        if (!testResponse.ok) {
          throw new Error('API not reachable');
        }
        log('‚úÖ API connection successful', 'success');

        // Fetch workspaces
        log('Fetching workspaces...', 'info');
        const workspacesResponse = await fetch(`${API_BASE}/api/onboardings`);
        const workspaces = workspacesResponse.ok ? await workspacesResponse.json() : [];
        
        if (workspaces.length > 0) {
          log(`‚úÖ Found ${workspaces.length} workspace(s)`, 'success');
        } else {
          log('‚ö†Ô∏è No workspaces found, creating appointments without workspace', 'warning');
        }

        // Create appointments (distribute across workspaces if available)
        let appointmentsCreated = 0;
        if (workspaces.length > 0) {
          // Create 25 appointments per workspace (up to 2 workspaces for demo)
          const workspacesToUse = workspaces.slice(0, 2);
          for (const workspace of workspacesToUse) {
            log(`Creating appointments for workspace: ${workspace.businessName}`, 'info');
            const count = await createAppointments(25, workspace.id);
            appointmentsCreated += count;
          }
        } else {
          appointmentsCreated = await createAppointments(50, null);
        }

        // Create resources
        const resources = await createResources();

        // Create resource bookings
        const bookingsCreated = await createResourceBookings(resources, 30);

        log('', 'info');
        log('üéâ Test data population complete!', 'success');
        log(`üìä Summary:`, 'info');
        log(`   - ${appointmentsCreated} appointments created`, 'success');
        log(`   - ${resources.length} resources created`, 'success');
        log(`   - ${bookingsCreated} resource bookings created`, 'success');
        log('', 'info');
        log('üëâ Click "View Reports Page" button to see the data!', 'info');

      } catch (error) {
        log(`‚ùå Error: ${error.message}`, 'error');
        log('Make sure the server is running at http://localhost:5001', 'warning');
      } finally {
        btn.disabled = false;
        btn.textContent = 'üöÄ Populate Test Data';
      }
    }

    function viewReports() {
      window.open('http://localhost:5173/dashboard/admin/reports', '_blank');
    }
  </script>
</body>
</html>
